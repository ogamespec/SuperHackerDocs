
                                                   Г Л А В А   11
-----------------------------------------------------------------
                                                   
                    S C R I P T S  (СКРИПТЫ)

-----------------------------------------------------------------
          
     
     Если вы  выполняете  некоторые  операции  регулярно,  услуга
Scripts (скрипты) может сохранить ваше время и силы. Она позволя-
ет записать набор команд, запускаемых нажатием  клавиш,  а  затем
выполнять  его в любой момент, используя одну или две клавиши для
запуска скрипта.
     Например, если вы часто вводите значения  продаж  в  таблицу
orders  (заказы), вы могли бы написать простую программу, которая
размещала бы таблицу orders в рабочем поле и активизировала  нуж-
ную  экранную  форму, чтобы упростить ввод данных. Используя воз-
можности запросов и отчетов системы Paradox, вы могли бы написать
программу, которая подготавливает накладные для заказанных  изде-
лий и автоматически обновляет архив.
     Несколько скриптов  можно  связывать  в один большой скрипт.
Такой подход облегчает разработку больших скриптов, которые авто-
матизируют решение целого ряда задач. Кроме того, с помощью услу-
ги Tools/More/Protect можно установить пароли для скриптов, чтобы
обезопасить информацию от несанкционированного доступа.
     Однако скрипты  -  это не просто набор клавишных команд. Они
могут также включать команды и функции языка программирования PAL
(Paradox Application Language - Язык приложений системы Paradox).
Объединяя возможности скриптов и языка PAL, можно создавать слож-
ные программны и приложения. Для создания приложений без програм-
мирования вы можете  использовать  систему  Personal  Programmer.
Вместе Paradox, Personal Programmer и PAL образуют мощное средст-
во высокого уровня для разработки приложений.
     В этой главе рассматривается только, как записывать и выпол-
нять  скрипты  без  использования  языка  PAL  и системы Personal
Programmer. Описание использования языка PAL в скриптах приводит-
ся в "Руководстве пользователя по языку  PAL".  Система  Personal
Programmer описана в  "Руководстве по системе  Personal  Program- 
mer".
     После того, как вы выберете услугу Scripts из Главного меню,
на экране появится меню с шестью услугами:
     
  -  Play (выполнить): выполнить предварительно записанный скрипт
     или запрос.
     
  -  BeginRecord (начать  запись): начать запись клавишных команд
     в новый скрипт.
     
  -  QuerySave (сохранить запрос): сохранить текущий запрос в ви-
     де скрипта.
     
  -  ShowPlay (выполнить с просмотром): выполнить скрипт с  прос-
     мотром всех клавишных команд.
  
  -  RepeatPlay (повторить выполнение): выполнить скрипт  опреде-
     ленное число раз.
     
  -  Editor (редактор): редактировать скрипт на экране.
  
     Вы можете также использовать клавиши {Alt}{F3} (запись  вст-
роенного  скрипта)  и  {Alt}{F4} (выполнение встроенного скрипта)
для записи и выполнения встроенного скрипта.
     Отметим, что скрипты можно также записывать и  выполнять  из
меню  PAL,  которое  вызывается нажатием клавиши {Alt}{F10} (меню
PAL). Это бывает полезно, когда вы выполняете какую-нибудь опера-
цию (например, создание отчета или формы), из которой  недоступно
Главное  меню. Услуги Play и BeginRecord в меню PAL идентичны со-
ответствующим услугам в меню Scripts.
     Если существует  последовательность  операций,  которую  вам
приходится  выполнять каждый раз при входе в систему Paradox, за-
пишите их в скрипт с именем init в том же каталоге, в котором на-
ходятся файлы системы Paradox. Этот скрипт может, например, изме-
нять текущий каталог, выдавать для просмотра определенную таблицу
или выдавать список таблиц. Init будет автоматически  выполняться
при каждом запуске системы Paradox. Более подробно о скрипте init
смотрите в главе 14.
     
     
     
     
                        PLAY  (ВЫПОЛНИТЬ)
-----------------------------------------------------------------
                   
     Для того,  чтобы  выполнить предварительно записанный скрипт
или запрос, выберите услугу Play из меню Scripts. Paradox  попро-
сит указать, какой скрипт нужно выполнить:
-----------------------------------------------------------------
Script:
Enter name of script to play, or press {Enter} to see a list of
scripts.
(Введите имя скрипта, который нужно выполнить, или нажмите
{Enter}, чтобы получить список скриптов.)
-----------------------------------------------------------------
     
     Наберите имя скрипта или нажмите {Enter} и выберите  его  из
меню. При желании вы всегда можете остановить выполнение скрипта,
нажав {Ctrl}{Break}.
     Услуга Play  показывает  на экране только конечный результат
выполнения скрипта. Все промежуточные шаги остаются невидимыми.
     Например, представьте,  что  скрипт  выбирает услугу Modify/
Edit из Главного меню, выбирает таблицу с именем agents  (агенты)
и  перемещае  курсор  на последнюю запись таблицы. При выполнении
скрипта вы увидите только конечный результат - таблицу  agents  в
режиме редактирования и курсор в последней записи. Если вы хотите
увидеть каждый  шаг  выполнения скрипта, используйте услугу Show-
Play (ее описание приводится ниже). Она особенно полезна при объ-
единении и отладке скриптов.
              
     
     
                         Ошибки скрипта
-----------------------------------------------------------------
     
     Если что-нибудь при выполнении скрипта получается неправиль-
но, вы  увидите сообщение "Script error" (Ошибка скрипта) и меню,
содержащее две услуги:
     
  -  Cancel (прервать): остановить выполнение скрипта и вернуться
     в главное рабочее поле.
  
  -  Debug (отладить): ввести отладчик  PAL  (PAL  Debugger)  для
     проверки и исправления скрипта.
     
     Многие ошибки скриптов являются ошибками выполнения, вызван-
ными тем, что скрипт выполняется не в том контексте, в котором он
был записан. Например, скрипт запроса  будет  выполняться  непра-
вильно, если вы находитесь в генераторе отчетов.
     Если вы  хотите использовать отладчик PAL для тестирования и
исправления скриптов, прочитайте главу 11 "Руководства  пользова-
теля по языку PAL".
     
     
     
     
                  BEGINRECORD  (НАЧАТЬ ЗАПИСЬ)
-----------------------------------------------------------------
     
     Услуга BeginRecord  (начать  запись) позволяет записать кла-
вишные команды в скрипт. Эта возможность  позволяет  вам  строить
модули  из  последовательностей  клавишных  команд и связывать их
вместе для дальнейшего использования в скриптах.  Пример  скрипта
приведен на рис. 11-1.
     
Рис. 11-1. Пример скрипта.
-----------------------------------------------------------------
           
           Очистить рабочее поле и отобразить Главное меню
         /                           Очистить таблицу table1
ClearAll                            /      Восстановить и за-
{Tools} {More} {Empty} {Table1} {OK}     / пустить скрипт запроса
{Scripts} {Play} {Query1} Do-It!   ------  query1
ClearAll ------------------------------- Очистить рабочее поле
{Tools} {More} {Add} {Answer} {Table1} --------
Menu {Report} {Output} {Table1} {1} {Printer}  \
Menu {Scripts} {End-Record}    \                 Добавить записи
\                               \             из answer в table1
 \                               \
  \                               Печатать записи в отчет 1
   Закончить скрипт
-----------------------------------------------------------------


     После того, как  вы  выберете  услугу  BeginRecord  из  меню
Scripts, Paradox попросит указать имя для нового скрипта:
-----------------------------------------------------------------
Script:
Enter name for a new script.
(Введите имя для нового скрипта.)
-----------------------------------------------------------------
   
     Имена скриптов,  как  и  имена  таблиц, могут содержать до 8
символов. После того, как  вы  наберете  имя  скрипта  и  нажмете
{Enter}, все клавишные команды будут записываться в скрипт до тех
пор,  пока  вы  не выберете услугу End-Record (закончить запись),
чтобы закончить скрипт. Если пространство в верхнем  правом  углу
экрана не занято Главным меню, вы будете видеть там индикатор за-
писи (R) во время записи скрипта.
     
     
     
                  Меню Scripts во время записи
-----------------------------------------------------------------
     
     Вл время записи скрипта вам доступны все возможности системы
Paradox  (за исключением записи другого скрипта). Если вы нажмете
{F10} (меню), на экране появится Главное меню. Единственное отли-
чие заключается в том, что меню услуги  Scripts  теперь  выглядит
специфично по отношению к обычному виду:
-----------------------------------------------------------------
*Cancel  End-Record  Play  QuerySave  RepeatPlay
Stop recording script without keeping it.
(Закончить запись без сохранения скрипта.)
-----------------------------------------------------------------
     
  -  Cancel (прервать): закончить создание программы, стереть  ее
     и вернуться в рабочее поле.
     
  -  End-Record (закончить  запись):  закончить  запись  скрипта,
     сохранить его и вернуться в рабочее поле.
     
  -  Play (выполнить): выполнить другой скрипт или запрос "изнут-
     ри" создаваемого.
     
  -  QuerySave (сохранить  запрос): сохранить запрос, находящийся
     в рабочем поле, в качестве нового скрипта.
     
  -  RepeatPlay (повторить выполнение): выпонить  скрипт  опреде-
     ленное число раз.
     
     Опция Play особенно важна. С ее помощью вы можете  создавать
небольшие модули из последовательностей клавишных команд, а затем
связывать их вместе для создания целого приложения.
     После того,  как  скрипт  записан,  с помощью услуг Scripts/
Play, Scripts/ShowPlay или Scripts/RepeatPlay  его  можно  выпол-
нить.
                                              
     
     
     
                  QUERYSAVE  (СОХРАНИТЬ ЗАПРОС)
-----------------------------------------------------------------
     
     Услуга QuerySave (сохранить запрос) позволяет записать теку-
щий запрос (все формы запроса, находящиеся в рабочем поле) в виде
скрипта. После того, как запрос сохранен, его не нужно каждый раз
набирать в рабочем поле.
     При выборе опции Play (выполнить) для скрипта запроса,  зап-
рос  будет перенесен в рабочее поле, но не будет выполнен. Вы мо-
жете при желании отредактировать его перед  тем,  как  выполнять.
Это означает, что вы можете использовать скрипт запроса как "шаб-
лон  запроса". Например, если вы часто связываете таблицы orders,
customer и products, вы могли  бы  сохранить  запрос,  содержащий
элементы  образцов  связи таблиц. Когда вы будете восстанавливать
запрос, эти образцы уже будут находиться  в  нем;  вам  останется
только проверить поля и ввести требуемые критерии выбора.
     Поскольку услуга QuerySave сохраняет все формы запроса в ра-
бочем  поле,  вы можете записать запрос после его выполнения. Это
означает, что можно составить запрос, проверить его,  отладить  и
выполнить, а затем - с помощью услуги QuerySave - сохранить.
     До того, как использовать услугу QuerySave, заполните  формы
запроса.  После  того,  как  вы выберете услугу QuerySave из меню
Scripts, Paradox попросит указать имя нового скрипта запроса:
-----------------------------------------------------------------
Query script name:
Enter name to be given to new script.
(Введите имя, которое будет дано новому скрипту.)
-----------------------------------------------------------------
     
     После того, как запрос записан, поместите его в рабочее поле
с  помощью  услуги Scripts/Play. Когда запрос находится в рабочем
поле, вы можете изменить его, если  хотите.  Затем  нажмите  {F2}
(выполнить),  чтобы выполнить запрос. Или вы можете записать дру-
гой скрипт для автоматического выполнения запроса.
     
                                                  
     
     
               SHOWPLAY  (ВЫПОЛНИТЬ С ПРОСМОТРОМ)
-----------------------------------------------------------------
     
     Если вы для выполнения скрипта  применяете  услугу  Scripts/
Play, то увидите только конечные результаты его выполнения. Услу-
га  ShowPlay позволяет просмотреть, шаг за шагом, выполнение каж-
дой клавишной команды в скрипте. Эта услуга полезна для  тестиро-
вания, обучения и отладки.
     После того, как вы выберете услугу ShowPlay из меню Scripts,
Paradox спросит, какой скрипт требуется выполнить:
-----------------------------------------------------------------
Script:
Enter name of script to play, or press {Enter} to see a list of
scripts.
(Наберите имя скрипта, который нужно выполнить, или нажмите
{Enter}, чтобы получить список скриптов.)
-----------------------------------------------------------------
     
     Наберите имя  скрипта или нажмите {Enter}, чтобы выбрать его
из меню.  Затем  Paradox  попросит  выбрать  скорость  выполнения
скрипта:
-----------------------------------------------------------------
*Fast  Slow
Play script rapidly.
(Выполнять программу без искусственных задержек.)
-----------------------------------------------------------------
     
  -  Fast (быстро): выполнять программу без искусственных  задер-
     жек.
     
  -  Slow (медленно):  выполнять программу со скоростью, приемле-
     мой для чтения.
     
     Если захотите, можете нажать {Ctrl}{Break}, чтобы остановить
выполнение скрипта.
     
            
     
     
               REPEATPLAY  (ПОВТОРИТЬ ВЫПОЛНЕНИЕ)
-----------------------------------------------------------------
     
     Услуга RepeatPlay  (повторить  выполнение) позволяет вам вы-
полнять один и тот же скрипт несколько раз подряд. Это бывает по-
лезно:
     
  -  для выполнения повторяемых макроопераций, таких, как  внесе-
     ние изменений в каждую запись таблицы;
     
  -  в сети, когда информация в вашей таблице постоянно изменяет-
     ся, и вы хотите соответственно изменять соответствующие зап-
     росы, таблицы crosstab или графики.
     
     Для получения  более  подробной  информации об использовании
RepeatPlay для создания систем  автообновления  графиков  в  сети
смотрите раздел  "Использование  скриптов  с графиками" в главе 6
книги "Представление данных системы Paradox".
     Как и при использовании услуги Play,  когда  вы  используете
RepeatPlay, то  видите  только конечные результаты. Вы можете ис-
пользовать услугу ShowPLay для просмотра выполнения  каждой  кла-
вишной команды, если вам нужно изменить или отладить скрипт.
     После того,  как  вы  выберете  услугу  RepeatPlay  из  меню
Scripts, Paradox спросит, какой скрипт требуется выполнить:
-----------------------------------------------------------------
Script:
Enter name of script to play, or press {Enter} to see a list of
scripts.
(Наберите имя скрипта, который нужно выполнить, или нажмите
{Enter}, чтобы получить список скриптов.)
-----------------------------------------------------------------
     
     Наберите имя скрипта или нажмите {Enter}, чтобы выбрать  его
из меню. Затем Paradox cопросит вас, сколько раз его выполнять:
-----------------------------------------------------------------
Number of times to repeat:
Enter the number of times to play the script or "c" for continuos
play.
(Введите число раз, которое нужно выполнять скрипт, или "c" для
постоянного выполнения.)
-----------------------------------------------------------------
     
     Постоянное выполнение скрипта  особенно  полезно, когда ваши
данные изменяются часто, как, например, во время службы  телемар-
кетинга. Если вам нужно остановить выполнение скрипта, можете на-
жать клавиши {Ctrl}{Break}.
     
     
     
                        EDITOR (РЕДАКТОР)
-----------------------------------------------------------------
     
     Услуга Editor  (редактор)  позволяет вам просмотреть и отре-
дактировать команды в записанном скрипте. Для просмотра и  редак-
тирования скриптов можно воспользоваться полноэкранным редактором
скриптов (Script Editor) ситемы Paradox. Из редактора также можно
распечатать  текст скрипта. Клавиши, используемые для перемещения
курсора и редактирования, описаны в разделах "Клавиатура" и  "Ре-
дактирование" в главе 2 данного руководства.
     Прежде, чем  редактировать  программу, рекомендуем прочитать
сначала главы 9 и 10 из "Руководства пользователя по языку  PAL",
где рассматривается построение скриптов и правила пользования ре-
дактором.
     Если вы предпочитаете редактировать скрипты с помощью вашего
собственного  текстового  процессора или редактора, вы можете ис-
пользовать программу конфигурации, чтобы эта услуга  меню  давала
доступ прямо к вашему собственному редактору. Для получения более
подробной информации смотрите главу 14.
     
     
                    
     
                       ВСТРОЕННЫЕ СКРИПТЫ
-----------------------------------------------------------------
     
     Возможность использования  встроенного скрипта позволяет вам
быстро записывать и выполнять скрипты.
     Чтобы начать запись встроенного скрипта, используйте команду
{Alt}{F3} (запись встроенного скрипта). Как и  при  использовании
услуги  Scripts/BeginRecord, в правом верхнем углу появится буква
R - индикатор записи скрипта. С этого момента все команды,  наби-
раемые  на  клавиатуре,  будут  записываться  в  скрипт  с именем
instant. Чтобы закончить запись, нужно еще раз нажать {Alt}{F3}.
     Чтобы выполнить  скрипт instant, нажмите {Alt}{F4}. Все кла-
вишные команды будут выполняться в том порядке, в котором  вы  их
набирали.
     Помните, что Paradox  поддерживает  только  один  встроенный
скрипт. В  следующий  раз,  когда вы нажмете {Alt}{F3} для записи
скрипта, новый скрипт перезапишет старый. Поэтому, чтобы защитить
встроенный скрипт от случайной перезаписи, воспользуйтесь услугой
Tools/Rename, чтобы переименовать его.

                 
     

                         СКРИПТЫ В СЕТИ
-----------------------------------------------------------------

     Paradox использует скрипты в сети иначе, чем другие объекты,
такие, как таблицы или отчеты:
     
  -  Двое или больше пользователей могут выполнять скрипт совмес-
     тно.
     
  -  Пока вы  редактируете  скрипт,  другие пользователи не могут
     редактировать или выполнять его.
     
  -  Пока вы выполняете скрипт, другие пользователи не могут  его
     редактировать.
     
     В отличие  от  других объектов, если вы пытаетесь редактиро-
вать или выполнить скрипт, который редактирует  другой  пользова-
тель, Paradox  не  сообщит  вам  имя  этого другого пользователя.
Вместо этого вы увидите  сообщение  типа  "Can't  access  script"
(Доступ к скрипту не разрешен).

     
     
     
                  ПРАВИЛА СОСТАВЛЕНИЯ СКРИПТОВ
-----------------------------------------------------------------
     
     За несколькими исключениями, рассмотренными в главе 2 "Руко-
водства  пользователя по языку PAL", скрипт системы Paradox "зах-
ватывает" любую  команду,  которую  вы  набираете  между  опциями
BeginRecord  и  End-Record.  Поэтому  очень важно иметь план, как
составить скрипт и выполнить каждую операцию. Помните, что с  мо-
мента записи скрипта до момента его выполнения база данных, с ко-
торой он работает, может измениться.
     Ниже приведены  некоторые  общие рекомендации по составлению
скриптов.
     
  -  Создавайте небольшие скрипты. Начинайте с  записи  небольших
     модулей.  Затем объединяйте их вместе выполнением маленького
     скрипта вместо записи сразу больших скриптов.
     
  -  Скрипты должны быть простыми. Если скрипт  сложный,  состав-
     ляйте  его  из  более простых, меньших по объему скриптов. В
     частности, если в программе есть запросы,  запишите  их  от-
     дельно с помощью услуги Scripts/Save.
     
  -  Подготовьте сначала  объекты. Подготовьте таблицы, формы или
     запросы для хранения, выдачи на экран и выбора данных до то-
     го, как записывать скрипт.
     
  -  Начинайте скрипт  с  чистки экрана. В общем случае начинайте
     скрипт с команды {Alt}{F8} (очистить  все),  чтобы  очистить
     рабочее  поле  и  выдать Главное меню. Можно избежать многих
     ошибок выполнения, если скрипты всегда выполняются с одной и
     той же начальной точки. Конечно, это правило  не  действует,
     если  скрипт  выполняется  из режимов Edit (редактирование),
     Form (форма), Report (отчет) или некоторых других.
     
  -  Очистите специальные  таблицы. Если вы используете специаль-
     ные таблицы для хранения или отображения  данных  (например,
     таблица table1 на рис.11-1), используйте услугу  Tools/More/
     Empty  внутри  скрипта,  чтобы предварительно очистить их. В
     противном случае в них может остаться информация со  времени
     выполнения предыдущего скрипта.
     
  -  Тестируйте скрипты. Если вы  обнаружили  ошибки  при  работе
     скрипта,  используйте  для тестирования услугу Scripts/Show-
     Play. Выполнение программы посредством этой услуги может по-
     мочь вам обнаружить ошибки.
     
  -  Редактируйте и совершенствуйте скрипты. Скрипты  хранятся  в
     файлах  с расширениями .SC (например, late.sc). Файл скрипта
     содержит команды, составляющие скрипт, в удобной форме.  Ис-
     пользуя  редактор  скриптов, вы можете редактировать и улуч-
     шать свои программы с помощью мощных команд языка PAL.  Под-
     робнее о командах языка PAL смотрите в главе 10 "Руководства
     пользователя по языку PAL".
