                                    - 1 -
         
                      ВИДЕОАДАПТЕР VGA - ОСНОВНЫЕ ОСОБЕННОСТИ
                                    С. Томпсон.
              Видеоадаптер VGA (Video Graphics Array - графическая видео
         матрица) - новый стандарт видеоподсистемы фирмы  IBM  для  ПЭВМ
         семейства PS/2 моделей 50 и выше. Видеоадаптер VGA  размещается
         на системной плате. Он был разработан для удовлетворения требо-
         ваний,  предъявляемых  к  новым  системам и, в то же время, для
         обеспечения совместимости с предыдущими  типами  видеоадаптеров
         при  большей  производительности  и расширенном наборе функций.
         Ввиду того, что адаптер IBM EGA (Enhanced  Graphics  Adapter  -
         усовершенствованный  графический  адаптер) стал видеостандартом
         для IBM - совместимых ПЭВМ, он был выбран в качестве основы для
         разработки VGA. Для повышения удобства работы и качества  изоб-
         ражения в VGA включены дополнительные 6 видеорежимов. Более вы-
         сокая производительность влечет за собой появление определенных
         затруднений  при  разработке системы, таких ка электромагнитную
         интерференцию, физические размеры и увеличение  стоимости.  Эти
         проблемы  были разрешены путем реализации функций видеоадаптера
         в одной вентильной матрице (gate array ) и использования анало-
         гового  дисплейного  интерфейса.  Применение  цифро-аналогового
         преобразователя  (ЦАП) позволяет адаптеру VGA формировать цвета
         из набора в 256К цветов при использовании цветного дисплея  или
         64 градации яркости при использовании монохромного дисплея. VGA
         - подсистема обеспечивает универсальный цветной и  монохроммный
         интерфейс,  что  позволяет  задавать цветной режим при работе с
         монохромным дисплеем и монохромный режим - с цветным  дисплеем.
         Разработан  алгоритм  сложения цветов, встроенный в BIOS (Basic
         Input/Output System - базовая система ввода/вывода), что позво-
         ляет представлять цвета при отображении на монохромном  дисплее
         различными градациями яркости.
              VGA - подсистема поставляется как стандартная на системных
         платах  IBM PS/2 моделей 50 и выше. VGA представляет собой раз-
         работанную фирмой  IBM  сверхбольшую  интегральныю  микросхему,
         обеспечивающую  новые  возможности работы с видеосистемой, но в
         то же время обладающую совместимостью с предыдущими  видеоадап-
         терами  фирмы  IBM,  такими как усовершенствованный графический
         адаптер (EGA). Установка видеоадаптера на системной плате пред-
         ставляет собой новый подход к размещению видеосистемы по  срав-
         нению с ПЭВМ IBM PC, PC XT и PC AT, где плата видеоадаптера ус-
         танавливалась  в дополнидельное гнездо. Для обеспечения высокой
         степени интеграции и функциональной полноты подсистема видеооб-
         служивания и другие устройства, такие  как  последовательный  и
         параллельный  порты  и порт устройства позиционирования курсора
         (pointing device port ) встроены в системную плату ПЭВМ семейс-
         тва PS/2. VGA обеспчивает возможность работы во всех ранее  ис-
         пользуемых  видеорежимах  и  шести дополнительных видеорежимах.
         Три новых режима - алфавитно - цифровые,  обеспечивающие  более
         четкое  изображение символов, что облегчает восприятие данных с
         экрана.   Остальные   три   режима   -   графические   (APA   -
.
                                    - 2 -
              
         All-Point-Addressable), обеспечивающие более высокое разрешение
         или  большее  количество  одновременно представленных на экране
         цветов. Новые видеофункции  спроектированы  для  удовлетворения
         возрастающих потребностей пользователей путем улучшения качест-
         ва  графического  представления, что снижает утомляемость глаза
         при продолжительной работе с экраном.
              Другой  новой особенностью ПЭВМ PS/2 является видео - ЦАП,
         который преобразует цифровые  сигналы  цветности  в  аналоговые
         сигналы  различного  уровня  "красного",  "зеленого" и "синего"
         цветов, принимаемые PS/2 дисплеями. ЦАП содержит цветовую  таб-
         лицу,  позволяющую каждый отображаемый на дисплее цвет выбирать
         из набора в 256К ( 262144 )  цветов.  (  Всюду  в  этой  статье
         К=1024  десятичное ). ЦАП позволяет получить до 64 градаций яр-
         кости на монохромных дисплеях PS/2. Другой новой и мощной  осо-
         бенностью системы видеообслуживания PS/2  является  возможность
         использовать цветные режимы при наличии монохромного дисплея и,
         наоборот, выбирать монохромный режим при  подключении  цветного
         дисплея.  Эти  особенности  позволяют  прикладному программному
         обеспечению  работать на всех машинах семейства PS/2 независимо
         от типа дисплея. Это означает, например, что программа, работа-
         ющая  на любой ПЭВМ PS/2 может использовать произвольный видео-
         режим. Для реализации такой  возможности  разработан  алгоритм,
         называемый "цветовое суммирование", выполняемый системой BIOS и
         преобразующий  информацию  о цветах в градации яркости примени-
         тельно  к монохромну дисплею. Предшествующие видеоадаптеры раз-
         работки  фирмы  IBM ограничивали возможность выбора видеорежима
         типом дисплея, подключенного к видеоаппаратуре. Монохромные ре-
         жимы были разрешены только в  случае  подключения  монохромного
         дисплея, а цветные - только при подключении цветного. Благодаря
         использованию  аналогового  дисплейного  интерфейса и алгоритма
         суммирования цветов, в PS/2 такие ограничения сняты.
                        Что нового в видеоадаптере VGA?
              Шесть новых операционных режимов. Как уже говорилось,  VGA
         обеспечивает шесть новых видеорежимов в дополнение к тем, кото-
         рыми располагают предыдущие видеоадаптеры фирмы IBM. ("Видеоре-
         жим"  - это определенный формат, в котором работает видеосисте-
         ма) Режимы, поддерживаемые VGA, выбраны с учетом  совместимости
         с  существующей  программной средой и, кроме того, обеспечивают
         видеофункции, позволяющие семейству PS/2  применять  программы,
         которые не могли функционировать на старых типах машин. Сегодня
         высокое  экранное  разрешение  обязательно; одно из ограничений
         ПЭВМ, разработанных ранее - невозможность отображения  фотогра-
         фий или сложных диаграмм без дополнительной дорогостоящей аппа-
         ратуры. Новые функции VGA позволяют это делать. Шесть новых ре-
         жимов включают три алфавитно-цифровых и три графических режима.
         Все режимы, включая совместимые режимы, обеспечивают  выбор  из
         256К  цветов  для цветного дисплея или 64 оттенков серого цвета
         для монохромного. Все режимы с вертикальным разрешением  в  200
         строк  функционируют  с двойным сканировании (double - scanned)
         одной и той же строки, таким образом,  отображая  400  строк  и
         увеличивая четкость изображение, что облегчат восприятие. Прог-
.
                                    - 3 -
         
         раммное обеспечение при этом "видит"  200  -  строковый  экран,
         т.к.  операции адресации поддерживаются аппаратно. Двойное ска-
         нирование также снижает стоимость дисплея позволяя использовать
         три размера по вертикали (350, 400 и 480 строк) вместо  четырех
         ( 200, 350, 400, 480 ).
              Все  режимы,  исключая графические режимы 640 x 480 пиксе-
         лов, используют вертикальную развертку с частотой  70  Гц,  что
         снижает  ощущаемое  пользователем мерцание экрана. Частота раз-
         вертки  для  режима  640  x 480 точек составляет 60 Гц. Частота
         строчной развертки составляет 31.5 кГц, что вдвое больше  теле-
         визионного  стандарта  NTSC, равного 15.7 кГц. Удвоение частоты
         строчной развертки позволяет в дисплеях IBM PS/2  обойтись  без
         использования черезстрочного режима развертки кадра, что умень-
         шает  мерцание  экрана.  Так как все режимы VGA используют 350,
         400 и 480 отображаемых на экране дисплея строк, то  при  работе
         на  частоте  15.7 кГц потребуется применении черезстрочной раз-
         вертки, позволяя за время одного кадра обновлять лишь  половину
         изображения.  Нечетные строки растра будут обановляться в тече-
         ние первого полукадра, а четные - в течение следующего, и т. д.
         Эффект чередования снижает  действительную  частоту  обновления
         экрана  вдвое,  увеличивая  мерцание  экрана. При использовании
         схемы без чередования строк, за период  времени  вывода  одного
         кадра  обновляются  все строки растра что приводит к уменьшению
         мерцаний.
                           Алфавитно - цифровые режимы.
                                                      Таблица 1
                 ┌───────┬─────────┬────────┬────────┬──────────┐
                 │ Режим │ Адаптер │ Размер │ Размер │   Тип    │
                 │       │         │ шрифта │ экрана │ атрибута │
                 ├───────┼─────────┼────────┼────────┼──────────┤
                 │  0, 1 │   CGA   │  8х8   │ 40х25  │ цветной  │
                 │  2, 3 │   CGA   │  8х8   │ 80х25  │ цветной  │
                 │ 0*, 1*│   EGA   │  8х14  │ 40х25  │ цветной  │
                 │ 2*, 3*│   EGA   │  8х14  │ 80х25  │ цветной  │
                 │   7   │   MDA   │  9х14  │ 80х25  │ монохром │
                 │ 0+, 1+│   VGA   │  9х16  │ 40х25  │ цветной  │
                 │ 2+, 3+│   VGA   │  9х16  │ 80х25  │ цветной  │
                 │   7+  │   VGA   │  9х16  │ 80х25  │ монохром │
                 └───────┴─────────┴────────┴────────┴──────────┘
              Новые режимы отмечены знаком "+".
              В таблице 1 представлен перечень  алфавитноцифровых  режи-
         мов,  поддерживаемых VGA: по три варианта режимов 0, 1, 2 и 3 и
         два варианта режима 7. Различные  варианты  предтавляют  разные
         размеры знакоместа символа. VGA вводит новые текстовые режимы с
         более  высоким разрешением, использующие знаковую матрицу 9*16.
         Это улучшает качество изображения и уменьшет утомляемость  глаз
         при длительной работе с экраном. Вертикальный размер знакоместа
         в 16 строк выбран из тех соображений, что использование размера
         символа  с большей высотой не намного улучшает качество изобра-
         жения символа при горизонтальном размере знакоместа в 9  точек,
.
                                    - 4 -
         
         но требует гораздо большего объема памяти ПЗУ BIOS для хранения
         шрифтов.  Обращение  к  видеофункции  BIOS, связанное с выбором
         размера символа производится отдельно и непосредственно не  за-
         висит от видеорежима, установка которого производится специаль-
         ной  функцией. Раздельные интерфейсы позволяют программам, раз-
         работанным до появления адаптера  VGA  устанавливать  текстовый
         режим  со  знаковой матрицей размером 9*16, тем самым используя
         преимущества новых режимов с высоким разрешением. При включении
         питания ПЭВМ семейства PS/2 автоматически устанавливается режим
         с  размером  знаковой  матрицы  9*16,  что позволяет программам
         пользоваться преимуществами высококачественных алфавитно-цифро-
         вых режимов в случае, если видеорежим устанавливается при помо-
         щи обращения к  BIOS.  Если  необходимо  использовать  алфавит-
         но-цифровой  режим с более низким разрешением, то размер знако-
         вой матрицы также может быть установлен путем обращения к соот-
         ветствующей  функции  BIOS. По умолчанию, при включении питания
         устанавливается режим 3+ при использовании цветного  дисплея  и
         режим  7+  для  монохромном  дисплея. Функциональное расширение
         VGA, присущее только алфавитно-цифровым режимам, заключается  в
         возможности одновременной загрузки восьми различных  шрифтов  в
         знакогенератор, расположенный в оперативной памяти (EGA - адап-
         тер  позволяет  загрузить  лишь  4 шрифта). Любые два из восьми
         шрифтов могут быть использованы для одновременного  отображения
         на  экране  дисплея, увеличивая число одновременно отображаемых
         символов до 512. Обычно только  256  различных  символов  могут
         быть  одновременно отображены на экране. Эта особенность допус-
         кает использование специальных эффектов  в  текстовых  режимах,
         таких  как курсив, полужирный шрифт или специальных графических
         символов. Система BIOS обеспечивает загрузку и отображение раз-
         личных символьных шрифтов.
                              Графические режимы.
                                                    Таблица 2
                 ┌───────┬─────────┬───────────────┬──────────┐
                 │ Режим │ Адаптер │ Размер экрана │  Атрибут │
                 │       │         │               │          │
                 ├───────┼─────────┼───────────────┼──────────┤
                 │ 4, 5  │   CGA   │   320х200     │  4 цвета │
                 │   6   │   CGA   │   640х200     │  2 цвета │
                 │   D   │   EGA   │   320х200     │ 16 цветов│
                 │   E   │   EGA   │   640х200     │ 16 цветов│
                 │   F   │   EGA   │   640х350     │ монохром │
                 │  10   │   EGA   │   640х350     │ 16 цветов│
                 │  11   │   VGA   │   640х480     │  2 цвета │
                 │  12   │   VGA   │   640х480     │ 16 цветов│
                 │  13   │   VGA   │   320х200     │256 цветов│
                 └───────┴─────────┴───────────────┴──────────┘
              В таблице 2 приведен список графических режимов, поддерди-
         ваемых  VGA - все режимы CGA и EGA плюс два новых режима с раз-
         решением 640 x 480 (режимы 11 и 12) и 256 - цветный режим  (ре-
.
                                    - 5 -
         
         жим 13). Режим 11 (двухцветный, с разрешением 640 x 480)  может
         быть  использован как при работе с адаптером VGA, так и при ра-
         боте с адаптером модели 30 серии PS/2 - MCGA (многоцветная гра-
         фическая матрица - Multi-Color Graphics Array). Этот режим раз-
         работан для программ, требующих экраннго разрешениея  640 x 480
         и  предназначенных для всех моделей семейства PS/2, включая мо-
         дель 30. Режим 12 уникален для VGA и поддерживает экранное раз-
         решение 640 x 480 с 16 цветами одновременно. Этот режим  разра-
         ботан  для использования в ситемах автоматизированного проекти-
         рования (САПР), деловой графики высокого разрешения и воспроиз-
         ведения полутоновых изображения. Экранное разрешение 640 x  480
         выбрано из соображений обеспечения одинаковости расстояния меж-
         ду пикселами по вертикали и горизонтали - квадратных пикселов -
         на  экране. Использование квадратных пикселов позволяет отобра-
         жать на экране окружности действительно окружностями, а не  эл-
         липсами,  как в случае экранного разрешения 640 x 200 или 640 x
         350, при которых вертикальное расстояние между пикселами больше
         горизонтального. Режим 13 разработан для обеспечения  высокока-
         чественного телевизионного изображения. Этот режим обеспечивает
         256-цветное  изображение  с разрешением 320 x 200 и может также
         быть использован в MCGA. Как указывалось выше выбор 256  цветов
         осуществляется из палитры размером 256К цветов. Возможность од-
         новременного  отображения  большого количества цветов позволяет
         создать у человека иллюзию большего экранного  разрешения,  чем
         это  есть  на  самом  деле.  Это  явление,  называемое  "anti -
         aliasing" (сглаживание) имеет место тогда, когда два  различных
         цвета  постепенно переходят друг в друга вместо резкого измене-
         ния цвета. Фотографии, введенные в ПЭВМ коммерческими устройст-
         вами ввода растровых образов (сканерами) могут быть в режиме 13
         достаточно точно отображены на экране, что позволяет  создавать
         картинные  персональные  базы  данных для хранения   фотографий,
         базы данных недвижимого имущества, включающие изображения  зда-
         ний и т.п. Новая версия программы, разработанной IBM "Ассистент
         -  чертежник"  (Drawing  Assistent)  обеспечивает поддержку как
         этого, так и других графических режимов VGA.
                 Новый единый интерфейс для монохромного и цветного
                                    мониторов
              Одной из задач, вставших при разработке видеоадаптера  VGA
         была  задача создания такой видеоподсистемы, которая бы поддер-
         живала все видеорежимы, независимо от типа применяемого монито-
         ра, то есть единый интерфейс для цветного и монохромного вывода
         изображений. При использовании многоцветных режимов на  цветных
         дисплеях изображение было бы цветным, а на монохромных дисплеях
         это  же изображение выводилось различными оттенками серого цве-
         та. А при использовании монохромных режимов, монохромные  атри-
         буты  интерпретировались как цветным так и монохромным дисплея-
         ми. Единый интерфейс позволяет при использовании недорогих кон-
         фигураций ситемы (PS/2  с  монохромным  дисплеем)  использовать
         преимущества  новых видеорежимов. В ПЭВМ типа IBM PC видеоадап-
         тер поддерживал только один тип дисплея :  монохромный  дисплей
         монохромным  дисплейным  адаптером  (MDA)  и  цветной дисплей -
.
                                    - 6 -
         
         цветным графическим адаптером (CGA). Если программа  ориентиро-
         вана  на использование определенного режима (например, цветного
         текстового режима), требуется соответствующая комбинация  адап-
         тера  и  дисплея  (в данном примере цветные дисплей и адаптер).
         Адаптер IBM EGA поддерживает как  цветной,  так  и  монохромный
         дисплеи,  но  он  позволяет задавать многоцветные режимы только
         при использовании цветного дисплея, а монохромные режимы -  при
         использовании  монохромного дисплея. Сделав видеорежимы сущест-
         венно независимыми от типа дисплея, VGA освобождает программное
         обеспечение от бремени поддержки обоих типов дисплеев. В  прог-
         рамме  может  быть выбран любой режим независимо от аппаратуры:
         цветной или монохромный. Так как видеорежим не зависит от  типа
         дисплея,  атрибуты  текстового  режима также не зависят от типа
         дисплея. Это означает  что  предложенные  в  меню  конфигурации
         "цвет" или "монохром" не обязывают к совпадению с типом дисплея
         в системе. Тип дисплея запрашивается для того, чтобы можно было
         выбрать видеорежим (и, таким образом,  тип  атрибута),  который
         требовался  для видеоадаптеров, предшествующих VGA. Так как VGA
         не требует, чтобы дисплей определенного типа использовал  опре-
         деленный  видеорежим  или тип атрибута, пользователь может выб-
         рать цветной режим, даже если в его систему включен монохромный
         дисплей (который отображает цвета как оттенки серого).  И,  ко-
         нечно,  можно выбирать "монохром", если подключен цветной дисп-
         лей. Чтобы понять, за счет чего это стало возможно, нужно отли-
         чать тип дисплея от типа атрибута.
              Термин ТИП ДИСПЛЕЯ относится к типу  дисплейного  монитора
         который физически связан с системным устройством. Цветной дисп-
         лей использует три цветовых сигнала (красный, зеленый и  синий)
         для  создания  различных  цветов на экране. Монохромный дисплей
         использует единственный цветовой сигнал и отображает  различные
         интенсивности одного цвета (белого на монохромном дисплее PS/2).
              Термин  ТИП  АТРИБУТА  относится к двум наборам атрибутов,
         которые используются монохромным дисплейным адаптером и цветным
         графическим адаптером. "Атрибут" представляет собой код,  кото-
         рый  сообщает аппаратуре адаптера, как отображать символ на эк-
         ране дисплея. Ниже описаны два типа атрибутов.
                           Монохромные атрибуты.
              Первые видеоподсистемы IBM  PC  состояли  из  монохромного
         дисплейного  адаптера  (Monochrome Display Adapter - MDA) и мо-
         нохромного дисплея фирмы IBM. Эта система обеспечивала  тексто-
         вый режим высокого разрешения с четырьмя имеющимися атрибутами:
         видимый,  видимый  повышенной яркости, подчеркивание и мигание.
         На рисуне 1 и таблица 3 приведены комбинации атрибутов и  соот-
         ветствующие коды для монохромного видеорежима.
.
                                    - 7 -
                                         
                            Монохромные атрибуты
         ┌───┬───┬───┬───┬───┬───┬───┬───┐
         │ 7 │ 6 │ 5 │ 4 │ 3 │ 2 │ 1 │ 0 │   Байт монохромных атрибутов
         └─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┘
           │   │   │   │   │   └───┴───┴──── Значение для цвета символа
           │   │   │   │   └──────────────── Яркость символа
           │   └───┴───┴──────────────────── Значение для фона
           └──────────────────────────────── Мигание
                                       Рис.1
                                                              Таблица 3
         ┌─────────┬─────┬─────────┬──────────┬─────────────────────────┐
         │ Мигание │ Фон │ Яркость │ Передний │         Результат       │
         │         │     │         │   план   │                         │
         ├─────────┼─────┼─────────┼──────────┼─────────────────────────┤
         │    0    │ 000 │    0    │   000    │ Нет изображения         │
         │    0    │ 000 │    0    │   001    │ Подчеркивание           │
         │    0    │ 000 │    0    │   111    │ Видимый                 │
         │    0    │ 000 │    1    │   001    │ Повышенная яркость с    │
         │         │     │         │          │ подчеркиванием          │
         │    0    │ 000 │    1    │   111    │ Повышенная яркость      │
         │    0    │ 111 │    0    │   000    │ Негативное изображение  │
         │    1    │ 000 │    0    │   001    │ Мигание с подчеркиванием│
         │    1    │ 000 │    0    │   111    │ Мигание, видимый        │
         │    1    │ 000 │    1    │   111    │ Мигание, повышенная     │
         │         │     │         │          │ яркость                 │
         │    1    │ 111 │    0    │   000    │ Мигание при негативном  │
         │         │     │         │          │ изображении             │
         └─────────┴─────┴─────────┴──────────┴─────────────────────────┘
                    Атрибуты для цветного графического адаптера
              Цветной  графический  адаптер фирмы IBM работает в цветном
         текстовом и графических режимах. Этот адаптер обеспечивает  де-
         сять  атрибутов  в текстовом режиме, состоящих из восьми цветов
         (черный, синий, зеленый, голубой, красный, пурпурный,  коричне-
         вый и белый), яркости и мигания. Атрибуты используются в комби-
         нации  для получения 16 цветов символа, 8 цветов фона и мигания
         символов. На рисунке 2 и в таблице 4 представлены атрибуты, оп-
         ределенные для CGA.
              Когда задается вопрос:"Какой тип  дисплея  используется?",
         подразумевается:  "Какой видеорежим или тип атрибута должен ис-
         пользоваться?". VGA позволяет пользователю сделать выбор  атри-
         бутов  до того как будет сделан выбор типа дисплея. Эта особен-
         ность позволяет увеличить степень "дружественности" по  отноше-
         нию к пользователю со стороны VGA и программного обеспечения.
.
                                    - 8 -
              
                    Атрибуты цветного графического адаптера
         ┌───┬───┬───┬───┬───┬───┬───┬───┐
         │ 7 │ 6 │ 5 │ 4 │ 3 │ 2 │ 1 │ 0 │   Байт атрибутов цвета
         └─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┘
           │   │   │   │   │   └───┴───┴──── Цвет символа
           │   │   │   │   └──────────────── Яркость символа
           │   └───┴───┴──────────────────── Цвет фона
           └──────────────────────────────── Мигание
                                       Рис.2
                                                       Таблица 4
         ┌─────────┬─────────┬──────────┬─────────────────────────┐
         │ Мигание │ Яркость │ Передний │         Результат       │
         │         │         │ план/фон │                         │
         ├─────────┼─────────┼──────────┼─────────────────────────┤
         │    0    │    0    │   000    │ Черный                  │
         │    0    │    0    │   001    │ Синий                   │
         │    0    │    0    │   010    │ Зеленый                 │
         │    0    │    0    │   011    │ Голубой                 │
         │    0    │    0    │   100    │ Красный                 │
         │    0    │    0    │   101    │ Пурпурный               │
         │    0    │    0    │   110    │ Коричневый              │
         │    0    │    0    │   111    │ Белый                   │
         │    Х    │    1    │   ХХХ    │ Яркий символ            │
         │    1    │    Х    │   ХХХ    │ Мигание символа         │
         └─────────┴─────────┴──────────┴─────────────────────────┘
               Другая новая особенность  -  суммирование цветов.
              Механизм, при помощи которого происходит отображение цвета
         оттенками  серого  на  монохромном дисплее, называется цветовым
         суммированием. Суммирование может быть осуществлено  программно
         или  аппаратно; предпочтение было отдано программному решению в
         силу большей гибкости и меньшей стоимости. Чтобы выполнить сум-
         мирование аппаратно, монохромный дисплей потребует три аналого-
         вых сигнала вместо одного, увеличивая стоимость кабеля и  аппа-
         ратуры отображения. Программный подход, являясь более простым и
         менее дорогим, позволяет программам отключать операцию суммиро-
         вания  и непосредственно управлять уровнями серого цвета. Меха-
         низм  суммирования  активизируется тогда, когда в программе ис-
         пользуется BIOS - интерфейс для задания одного или более регис-
         тров цвета в цифро-аналоговогом преобразователе. Вместо  приме-
         нения  алгоритма  суммирования  для  16 задаваемых по умолчанию
         цветов заранее выбраны 16 оттенков серого с наибольей  степенью
         контрастности между ними. Уровень результирующего сигнала серо-
         го формируется в соответствии с алгоритмом: 30% уровня красного
         плюс  59% уровня зеленого плюс 11% уровня синего. Алгоритм сум-
         мирование преобразует 18 бит, определяющих цвет в 6 битов уров-
         ня серого. Веса для красного,  зеленого  и  синего  компонентов
.
                                    - 9 -
         
         выбраны в соответствии с чувствительностью глаза к этим цветам.
         В  результате  работы алгоритма суммирования вычисляются уровни
         серого, при которвых обеспечивается минимальная потеря информа-
         тивности по отношению к исходному цветном изображению.  Рисунок
         3 графически иллюстрирует механизм суммирования цветов.
                           Суммирование цветов
         Значение красного (6 бит)    Суммирующий алгоритм
         ┌───┬───┬───┬───┬───┬───┐ ┌─────┐
         │ 5 │ 4 │ 3 │ 2 │ 1 │ 0 ├─┤ 30% │
         └───┴───┴───┴───┴───┴───┘ │     │
                                   │     │
         Значение зеленого (6 бит) │     │ Суммарное значение (6 бит)
         ┌───┬───┬───┬───┬───┬───┐ │     │ ┌───┬───┬───┬───┬───┬───┐
         │ 5 │ 4 │ 3 │ 2 │ 1 │ 0 ├─┤ 59% ├─┤ 5 │ 4 │ 3 │ 2 │ 1 │ 0 ├─┐
         └───┴───┴───┴───┴───┴───┘ │     │ └───┴───┴───┴───┴───┴───┘ │
                                   │     │ ┌─────────────────────────┘
         Значение синего   (6 бит) │     │ │┌─────── Красный ──────>
         ┌───┬───┬───┬───┬───┬───┐ │     │ ││
         │ 5 │ 4 │ 3 │ 2 │ 1 │ 0 ├─┤ 11% │ └┼─────── Зеленый ──────>
         └───┴───┴───┴───┴───┴───┘ │     │  │
                                   └─────┘  └───────  Синий  ──────>
                                       Рис.3
              На рисунке 3 показано, как суммарная величина посылается в
         дисплей  тремя  цветовыми  сигналами, что позволяет получить на
         цветном мониторе точно такое же черно-белое изображение  что  и
         на  монохромном. Такое суммирование может быть проведено разра-
         ботчиком программного обеспечения применительно к цветному  мо-
         нитору с тем чтобы увидеть как цветное изображение будет выгля-
         деть  на  экране монохромного монитора. Это позволяет уменьшить
         количество используемой при разработке универсального программ-
         ного обеспечения аппаратуры. При этом необходимо  помнить,  что
         суммарные значения записываются  в  регистры  цифро-аналогового
         преобразователя и исходные уровни сигналов красного, зеленого и
         синего  теряются.  Это  означает,  что если цветовые компоненты
         нужно сохранить на время использования монохромного режима,  то
         программа  должна запомнить их любым способом и не ожидать, что
         их можно будет прочитать из ЦАП после окончания работы  в  этом
         режиме.
.
                                    - 10 -
              
                        Аппаратура видеоадаптера VGA
         ┌─────┐              ┌─────┐
         │ ЦП  ├─┬────────────┤ ЦАП ├───── Красный ──────>
         └─────┘ │            │     ├───── Зеленый ──────> На дисплей
                 │         ┌──┤     ├─────  Синий  ──────>
           ┌─────┴─────┐   │  └─────┘
           │VGA        ├───┤
           │           ├───│─┬───────── Синхронизация ───>
           └─────┬─────┘   │ │
                 │         │ │
                 │         │ │
           ┌─────┴─────┐   │ │┌─────┐
           │256К       │   │ └┤AVC  │
           │видеопамять│   └──┤     │
           └───────────┘      └─────┘
                                       Рис.4
              VGA и видеопамять.
              
              Видеоадаптер  VGA,  схема которого приведена на рисунке 4,
         включает в себя собственно микросхему VGA, 256K байтов видеопа-
         мяти, ЦАП, разъем аналогового дисплея и вспомогательный  видео-
         разъем (AVC - Auxilary Video Connector). VGA представляет собой
         наибольшую  вентильную матрицу на системной плате; она содержит
         10000 элементов (cells, "cell" - это основная единица,  исполь-
         зуемая  при измерении размера вентильных матриц) и логику, тре-
         буемую для эмуляции EGA и поддержки шести новых режимов. Испол-
         нение в виде одной СБИС выбрано для минимизации площади, требу-
         емой  видеоподсистемой и для увеличения надежности компьютерной
         системы в целом. Если бы потребовалась использование в адаптере
         более одной вентильной матрицы, то такая видеосистема не  могла
         бы  быть размещена на системной плате, что противоречило бы но-
         вой идеологии фирмы IBM по размещению наиболее часто используе-
         мых устройств ПЭВМ на системной плате. Исполнение в одной  СБИС
         увеличивает  надежность  видеосистемы  за счет уменьшения числа
         компонент.  Наконец,  электромагнитное  излучение   значительно
         уменьшено  благодаря  применению  однокорпусной технологии, так
         как большинство  логических  переключателей  содержится  внутри
         СБИС, где токи переключения и длины проводников чрезвычайно ма-
         лы. Благодаря большим усилиям затраченным на минимизацию логики
         и эффективному проектированию, все функции адаптера VGA удалось
         реализовать при помощи вентильной матрицы размером в 10000 эле-
         ментов.
              Проектирование  СБИС связано с проблемой проверки правиль-
         ности выполненной разработки. Как можно гарантировать соответс-
         твие разработанного устройства специфицации? Было выяснено, что
         макет  VGA, собранный из отдельных логических  элементов  будет
         очень громоздким, ввиду чего проверка правильности его функцио-
         нирования  будет  весьма затруднительной. Кроме того, имеющиеся
         цифровые логические устройства не полностью соответствуют логи-
.
                                    - 11 -
         
         ческим элементам, используемым для реализации  проекта.  (Логи-
         ческие элементы представляют собой логические строительные бло-
         ки,  такие как схемы И, ИЛИ и т. п. ). Компьютерное моделирова-
         ние VGA было единственным практическим средством проверки рабо-
         тоспособности системы. Задача моделирования 10000 -  элементной
         вентильной  матрицы  VGA была выполнена путем разбиения ее на 5
         функциональных частей и моделирования каждой из  них  отдельно.
         Затем эти части были соединены, и моделирование было продолжено
         применительно  к  микросхеме  в целом. При таком подходе быстро
         выявлена подавляющая часть ошибок, которые были исправлены пос-
         ле чего моделирование было выполнено снова. В такой  разработке
         как VGA, число возможных состояний аппаратуры практически  бес-
         конечно.  Так  как невозможно смоделировать все состояния, были
         выбраны лишь типичные. Работа по моделированию  была  проделана
         несколькими  инженерами  и потребовала мощности большого компь-
         ютера.
              Одной из новых функций, которая повлияла на  размеры  VGA,
         является  наличие  регистров,  значения в которых могут быть не
         только записаны, но и прочитаны процессором, что облегчает  вы-
         полнение операций сохранения и восстановления информации, необ-
         ходимых  при использовании системы во многозадачной среде. Пос-
         кольку многие программы используют дисплейный экран непосредст-
         венно, необходима аппаратная поддержка операций сохранения/вос-
         становления  значений  видеорегистров.  Наличие  регистров типа
         "запись/чтение" обеспечивает также возможность выполнения  пос-
         ледовательности  операций чтение-модификация-запись, что позво-
         ляет программам модифицировать выбранные биты  в  регистре  без
         изменения  остальных. Реализация функции чтения регистров обес-
         печена мультиплексорной схемой, а не путем применения  внутрен-
         ней  трехстабильной  шины. Внутри VGA нет трехстабильных линий,
         так как такой тип шины не удовлетворяет высоким  требованиям  к
         тестируемости, предъявляемым фирмой IBM.
              Для  того  чтобы  использование всех возможностей адаптера
         VGA не требовало установки дополнительной памяти, размер  стан-
         дартной  памяти  адаптера был сразу выбран равным 256 Кб. Прог-
         раммам, работающим совместно с VGA нет необходимости  проверять
         объем  памяти в составе адаптера. Кроме того, это позволяет по-
         высить надежность видеоподсистемы. Так как модули памяти  могут
         быть впаяны непосредственно в системную плату без использования
         панелек,  ошибки, связаеные с неправильной установкой микросхем
         памяти или плохими контактами исключаются.
              Комбинация VGA с видеопамятью в  256К  байтов  сравнима  с
         платой  EGA  в полной конфигурации. В состав VGA по сравнению с
         EGA добавлено два новых устройства: ЦАП и вспомогательный виде-
         оразъем.
                              Видео  -  ЦАП.
              ЦАП преобразует 8 битов цифровой  цветовой  информации  из
         микросхемы  VGA  в  аналоговые сигналы, используемые мониторами
         PS/2. Используемый тип  цифро-аналогового  преобразователя  был
         выбран в связи с тем, что он обеспечивает просмотр таблицы цве-
         тов на вход которой поступает 8-битовый сигнал, а на выходе ге-
.
                                    - 12 -
         
         нерируется аналоговый сигнал с 6-битовым разрешением по яркости
         для  каждого  из  базовых цветов (красный, синий, зеленый), что
         дает возможность отображения 256К цветов. Рисунок 5 иллюстриру-
         ет работу ЦАПа. 8 - битовое значение цвета используется как ад-
         рес для выбора одного их 256 регистров в  таблице  цветов  ЦАП.
         Каждый  из регистров цвета в ЦАП содержит 18 битов и состоит из
         6 битов для красной, 6 битров для зеленой и 6 битов  для  синей
         составляющей.  Каждая 6- битовая составляющая преобразуется за-
         тем в аналоговые сигналы тремя цифро-аналоговыми преобразовате-
         лямими. Таблица цветов заполняется либо программами BIOS,  либо
         непосредственно  прикладной  программой.  Значения  регистров в
         этой таблице могут быть прочитаны процессором, что дает возмож-
         ность выполнять операции  типа  сохранение/восстановление.  Для
         обеспечения совместимости BIOS программирует ЦАП таким образом,
         что  начальные цвета совпадают с цветами, используемыми EGA  во
         всех режимах, исключая 256 - цветный  режим  (режим  13h).  Это
         позволяет  использовать  программы  разработанные  для адаптера
                           Структура видео ЦАПа
                          ┌─────────────────────────────┐
                          │ Цветовая таблица видео ЦАПа │
                          └─────────────────────────────┘
                          6 бит  6 бит  6 бит
                          ┌─────┬──────┬──────┐
                          │Синий│Зелен.│Красн.│
                          ├┬┬┬┬┬┼┬┬┬┬┬┬┼┬┬┬┬┬┬┤ Регистр   0
         8 бит            ├┴┴┴┴┴┼┴┴┴┴┴┴┼┴┴┴┴┴┴┤
         значение         │Синий│Зелен.│Красн.│
         цвета            ├┬┬┬┬┬┼┬┬┬┬┬┬┼┬┬┬┬┬┬┤ Регистр   1
         ───────────────> ├┴┴┴┴┴┼┴┴┴┴┴┴┼┴┴┴┴┴┴┤
                          │     │      │      │
                          ┴     ┴      ┴      ┴
                             . . . . . . . .
                          ┬     ┬      ┬      ┬
                          ├─────┼──────┼──────┤
                          │Синий│Зелен.│Красн.│
                          ├┬┬┬┬┬┼┬┬┬┬┬┬┼┬┬┬┬┬┬┤ Регистр  255
                          └┴┴┴┴┴┴┴┴┴┴┴┴┴┴┴┴┴┴┴┘
                             ┬     ┬      ┬      ЦАП
                             │     │      │    ┌─────┐
                             │     │      └────┤ D/A ├──  Синий  ────>
                             │     │           └─────┘
                             │     │           ┌─────┐
                             │     └───────────┤ D/A ├── Красный ────>
                             │                 └─────┘
                             │                 ┌─────┐
                             └─────────────────┤ D/A ├── Зеленый ────>
                                               └─────┘
                                       Рис.5
.
                                    - 13 -
         
         EGA  применительно к VGA без появления  искажений  цветов.  Эти
         цвета, конечно, могут быть изменены путем модифицикации таблицы
         цветов для чего в состав программ BIOS включена соответствующая
         функция.  Рекомендуется для формирования таблицы цветов исполь-
         зовать  именно функцию BIOS т.к. эта программа может преобразо-
         вывать цвета к оттенкам серого, что существенно при использова-
         нии  в системе с монохромным дисплеем. Этот механизм преобразо-
         вания называется суммированием цветов и был описан ранее.
              
                        Вспомогательный видеоразъем.
              Вспомогательный видеоразъем (auxiliary video  connector  -
         AVC) представляет собой расширение разъема типа микроканал, ко-
         торый разработан для простоты расширения видеоподсистемы и  для
         устранения  количества аппаратуры, которая оказывалась "лишней"
         при заменене видеоадаптера новой платой как это было в предшес-
         твующих моделях ПЭВМ. Этот разъем обеспечивает доступ к  цифро-
         вому интерфейсу между VGA и ЦАП через дополнительную плату, ко-
         торая может получать цифровые сигналы  от  VGA,  или  управлять
         ЦАПом (и, таким образом, дисплеем) своими собственными цифровы-
         ми сигналами. AVC обеспечивает возможность подключения дополни-
         тельных  видеоадаптеров,  причем  при  этом нет необходимости в
         этом дополнительном адаптере поддерживать совместимость с  VGA,
         так как всегда может быть использован VGA установленный на сис-
         темной  плате. В качестве примера дополнительного видеоадаптера
         можно назвать дисплейный  адаптер  IBM  8514/A,  обеспечивающий
         возможность  работы в двух дополнительных видеорежимах с разре-
         шением 640 x 480 пикселов с одновременным представлением на эк-
         ране 256 цветов (может быть использован с любым цветным монито-
         ром PS/2) и 1024 x 768 пикселов в 256 цветах  (только  при  ис-
         пользовании  дисплея 8514). Адаптер 8514/А получает видеокод от
         установленного на системной плате VGA через вспомогательный ви-
         деоразъем и отображает его на дисплее, подключенном  к  8514/A.
         При  работе  в режимах, поддерживаемых только адаптером 8514/A,
         им будут генерироваться собственные видеосигналы, а сигналы VGA
         игнорироваться.
               Почему используется  аналоговый  дисплейный интерфейс?
              Видеоадаптер VGA используются вместе с аналоговыми диспле-
         ями  в  отличие от более старых типов видеоадаптеров фирмы IBM,
         работающих совместно с мониторами с цифровым видеовходом  (MDA,
         CGA и EGA). Возникает вопрос, почему фирма IBM выбрала аналого-
         вые  дисплеи,  в то время как телевизионная индустрия стремится
         перейти к цифровому  телевидению.  В  телевидении  используется
         цифровая  обработка  информации,  полученной  с эфира. Цифровые
         данные затем преобразуются в аналоговые для  управления  элект-
         ронно лучевой трубкой (ЭЛТ). Фирма IBM выбрала аналоговые дисп-
         леи  по  нескольким причинам таким как, число отображаемых цве-
         тов, количество проводов в кабеле,  электромагнитную  совмести-
         мость  и способность к наращиванию. При использовании цифрового
         дисплейного интерфейса число требуемых цифровых  сигналов  воз-
         растает  с  увеличением  числа отображаемых цветов. Зависимость
         может быть выражена следующим образом:
.
                                    - 14 -
                                          
                 ЧИСЛО СИГНАЛОВ = двоичный логарифм от числа цветов
         или
                  2 в степени  ЧИСЛО СИГНАЛОВ  = ЧИСЛО ЦВЕТОВ.
         Например,  в CGA используются  16 цветов и, следовательно:
                    ЧИСЛО СИГНАЛОВ = LOG base 2 ( 16 ) = 4,
         или
                     2 в степени 4 = 16 ЦВЕТОВ.
         EGA позволяет отображать 16 цветов из набора в 64  цвета.  Хотя
         мы можем отобразить одновременно лишь 16 цветов, дисплейный ин-
         терфейс должен формировать 64 различных цветовых кода, в  связи
         с  чем  улучшенный цветной дисплей использует 6 линий связи для
         управления цветом:
                     ЧИСЛО СИГНАЛОВ = LOG base 2 ( 64 ) = 6.
         VGA - подсистема позволяет отображать одновременно  256  цветов
         из набора 256К цветов. Цифровая реализация 256К цветов потребу-
         ет 18 линий связи для управления цветом. Такой интерфейс потре-
         бует  использования разъема с довольно большим количеством кон-
         тактов и кабеля  с  большим  количеством  проводников,  создаст
         проблемы  электромагнитных  помех, надежности и удобства приме-
         ния. Каждый провод в кабеле действует  как  антенна,  генерируя
         электромагнитное  излучение,  на  которое специальными службами
         накладываются жесткие ограничения. Целью таких ограничений  яв-
         ляется минимизация уровня фона; наличие большого  числа  прово-
         дов,  излучающих  на высоких видеочастотах, не является хорошим
         средством для достижения этой цели. Так как аналоговых сигналов
         только три, коаксиальный кабель позволяет согласовать  импеданс
         видеокабеля  с  видеовыходом системной платы (ЦАП и нагрузочные
         резисторы) и дисплейным входом. Согласование импедансов снижает
         затухание сигнала, отражения и шумы, обеспечивая ясный,  резкий
         видеообраз  на  экране дисплея. Т.к. каждый сигнальный провод в
         коаксиальном кабеле экранирован, коаксиальный кабель сам по се-
         бе резко снижает уровень электромагнитного излучения  при  про-
         хождении  видеосигналов.   Примененпие  аналогового  интерфейса
         увеличивает надежность ввиду меньшего  количества  используемых
         проводов по сравнению с цифровым интерфейсом, и меньшей вероят-
         ности  возникновения  искажений связанных с возможностью обрыва
         провода. Наконец, еще один аргумент против применения цифрового
         сигнала управления монитором - "толстый", жесткий и сложный для
         контроля исправности кабель.
              Другой причиной того, что предпочтение было отдано  анало-
         говому  дисплею является расширение возможностей видеосистемы в
         дальнейшем. Цифровой дисплей отображает  только  набор  цветов,
         поддерживаемых  набором  сигнальных  линий в кабеле. Аналоговый
         дисплей обеспечивает непрерывный спектр цветов,  число  которых
         почти не ограничено. Число цветов для аналогового дисплея опре-
         деляется возможностями самого видеоадаптера. В настоящий момент
         VGA позволяет осуществлять выбор из 256К цветов. Развитие виде-
.
                                    - 15 -
         
         оаппаратуры могло бы увеличить это число и при  этом  использо-
         вать все те же аналоговые дисплеи. Палитра в 256К цветов дости-
         гается применением трех аналоговых сигнала цветности (красного,
         зеленого и синего), которые могут принимать любые из 64 различ-
         ных  значений.  Таким  образом, (64 уровня красного)x(64 уровня
         зеленого)x(64 уровня синего)=262144 цвета. Монохромный  дисплей
         использует  только один цветовой сигнал, поэтому он может отоб-
         ражать 64 оттенка серого :
              (64 цветовых значений) = 64 оттенка серого.
         Аналоговые дисплеи принимают цветовые сигналы, диапазон  напря-
         жение  которых составляет от 0.00 В (уровень черного) до 0.70 В
         (уровень белого). VGA разбивает этот диапазон на 63 части  (для
         получения 64 различных значений интервал необходимо раздить  на
         63 части). Разница между двумя соседними уровнями составляет:
                      0.70 В / 63 = 11.1 мВ.
         Таким  образом  VGA управляет аналоговыми цветовыми сигналами с
         дискретностью в 11.1 мВ. Если бы в  будущем  видеоадаптере  ис-
         пользовался меньший шаг, то можно было бы вложить в диапазон от
         0.00  до  0.70В большее число шагов и, следовательно,обеспечить
         возможность отображения большего количества цветов на существу-
         ющих дисплеях.
                              Заключение.
              Благодаря использованию технологии СБИС  (VLSI  -  Very  -
         Large  - Scale Integration) и аналогового дисплейного интерфей-
         са, видеоадаптер VGA обеспечивает широкий  набор  видеофункций,
         высокую  производительность  и  надежность, что открывает новые
         возможности для применения персональных компьютеров.  Однокрис-
         тальный  VGA  позволяет разместить видеоподсистему на системной
         плате, что  позволяет  уменьшить  электромагнитнвые  искажения.
         Аналоговый  интерфейс  дает большие возможности выбора цветов и
         обеспечивает универсальный интерфейс для цветного и монохромно-
         го дисплеев, и, таким образом, использовать произвольный видео-
         режим независимо от типа монитора. В видеоадаптере VGA расширен
         спектр используемых видеорежимов, включены  средства  поддержки
         многозадачности  и,  в  то же время, достигнута высокая степень
         совместимости предшествующими типами видеоадаптеров. Это позво-
         ляет применять его при решении широкого класса прикладных задач
         связанных с обработкой не только алфавитно-цифровой но и графи-
         ческой информации.
